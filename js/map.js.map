{"version":3,"sources":["../es6_js/map.js"],"names":[],"mappings":"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","file":"map.js","sourcesContent":["/**\n * Created by wwymak on 05/12/2015.\n */\n\nclass ukMap {\n    constructor(\n        {height = 900, width = 900,\n        scale = 4000,\n        selection = \"body\",\n        projection = d3.geo.albers()\n            .center([4.5, 57])\n            .rotate([4.4, 0])\n            .parallels([50, 60])\n            .scale(scale),\n        viewBox = \"0 0 400 800\"} = {}\n    ) {\n        this.height = height;\n        this.width = width;\n        this.selection = selection;\n        this.projection = projection;\n        this.viewBox = viewBox;\n    }\n\n    get mapHeight(){\n        return this.height;\n    }\n\n    mapVis(selection){\n        var svg, svgG;\n\n\n    }\n}\n\n/**\n * Class to hold the traffic vol data for a year, plus some basic ops\n */\nclass mapData {\n    constructor(trafficData, {\n\n        } = {}){\n        this.trafficData = trafficData;\n        this.quantize = d3.scale.quantize().range(d3.range(0.5,2.5,0.15));\n    }\n\n    /**\n     *\n     * @param categoryName -- one of \"PedalCycles\", \"Motorcycles\",\n     * \"CarsTaxis\",\t\"bus\", \"AllHGVs\", \"AllMotorVehicles\"\n     */\n    maxValOfCategory(categoryName){\n        return  d3.max(this.trafficData, (d) => {\n            return d[categoryName];\n        });\n    }\n\n    minValOfCategory(categoryName){\n        return  d3.min(this.trafficData, (d) => {\n            return d[categoryName];\n        });\n    }\n\n    quantizeScale(categoryName){\n        return this.quantize.domain([this.minValOfCategory(categoryName), this.maxValOfCategory(categoryName)])\n    }\n}\n\n(() => {\n    var mapSVG = initMap();\n\n    windowResizeHandler();\n\n    var projection = d3.geo.albers()\n        .center([12, 57])\n        .rotate([10, 0])\n        .parallels([50, 60])\n        .scale(4300),\n\n        path = d3.geo.path()\n            .projection(projection);\n\n    var dataMap = new Map(),\n        mapProperties, roadScale;\n\n\n    queue().defer(d3.json, 'data/a_road_topo.json')\n        .defer(d3.json, 'data/M_road_topo.json')\n        .defer(d3.csv, 'data/uk-traffic-2000.csv')\n        .defer(d3.csv, 'data/uk-traffic-2001.csv')\n        .await((error, aRoad, MRoad, uk_2000_traffic, uk_2001_traffic) => {\n            console.log(\"all done\");\n\n            mapProperties = new mapData(uk_2000_traffic)\n            roadScale = mapProperties.quantizeScale(\"AllMotorVehicles\")\n\n            var maxVal = d3.max(uk_2000_traffic, (d) => {\n                return d.AllMotorVehicles\n            });\n\n            //quantisation scale for setting thickness of roads\n            var quantize = d3.scale.quantize().domain([0, maxVal]).range(d3.range(0.2,2.5,0.15));\n\n            uk_2000_traffic.map((d) => {\n                dataMap.set(d.road, {\n                    year: +d.year,\n                    cycles: +d.PedalCycles,\n                    motors: +d.AllMotorVehicles\n                })\n            });\n\n            console.log(maxVal, uk_2000_traffic)\n\n\n            var geoData = [topojson.feature(aRoad, aRoad.objects.a_road_trimmed),\n                topojson.feature(MRoad,MRoad.objects.M_road_trimmed)\n            ];\n\n            var roads = mapSVG.selectAll(\"g.road\").data(geoData)\n                .enter().append(\"g\")\n                .attr(\"class\", \"road\")\n                .attr(\"id\", (d, i) => {\n                    if(i == 0){\n                        return \"a-road\"\n                    } else if (i == 1){\n                        return \"m-road\"\n                    }\n                });\n\n            roads.selectAll(\"g\")\n                .data((d) => {\n                    console.log(d)\n                    return d.features;\n                }).enter()\n                .append(\"path\")\n                .attr(\"d\", path)\n                .attr(\"class\", \"roadPath\")\n                .style(\"stroke\", (d, i) =>{\n                    //if(i == 0){\n                    //    return \"orange\"\n                    //}\n                    //if(i == 1){\n                    //    return \"red\"\n                    //}\n                    return \"white\"\n                }).style(\"stroke-width\", (d, i) => {\n                    var roadNumber = d.properties.roadNumber;\n                    var valObj = dataMap.get(roadNumber) || {};\n\n                    return roadScale(valObj.motors || 0.2);\n                }).on(\"mouseover\", (d,i) => {\n                var roadNumber = d.properties.roadNumber;\n                var valObj = dataMap.get(roadNumber) || {};\n                console.log(roadNumber, valObj)\n            });\n\n\n            /**\n             * Update the roadwidth when toggling between viewing the map for\n             * @param vehicleType \"motors\" or \"cycles\" as per above\n             */\n            var updateRoadWidth = function(vehicleType = \"motors\"){\n                console.log(\"click\")\n                d3.selectAll(\".roadPath\").style(\"stroke-width\", (d, i) => {\n                    var roadNumber = d.properties.roadNumber;\n                    var valObj = dataMap.get(roadNumber) || {};\n\n                    return quantize(valObj[vehicleType] || 1);\n                })\n            }\n\n            var  setBtnClickHandler = function(){\n                d3.select(\"#motorDataSelect\").on(\"click\", updateRoadWidth);\n                d3.select(\"#cycleDataSelect\").on(\"click\", () =>{updateRoadWidth(\"cycles\")});\n            }\n\n            setBtnClickHandler();\n\n\n        });\n\n    function initMap(){\n        var dimen = d3.min([window.innerHeight, window.innerWidth])\n        var width = 0.8 * dimen,\n            height = dimen;\n\n        return d3.select(\"#ukMap\").append(\"svg\")\n            .attr(\"width\", width)\n            .attr(\"height\", height)\n            .attr(\"viewBox\", \"0 0 400 800\")\n            .attr(\"preserveAspectRatio\", \"xMinYMin meet\");\n    }\n\n    function windowResizeHandler(){\n        var resizeTimer;\n        d3.select(window).on(\"resize\", () => {\n            clearTimeout(resizeTimer);\n            resizeTimer = setTimeout(() =>{\n                var width = 0.8 * window.innerHeight,\n                    height = window.innerHeight;\n\n                mapSVG.attr(\"width\", width).attr(\"height\", height);\n            }, 200)\n        });\n    }\n\n\n\n\n\n})();"]}